(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{21:function(e,n,t){},25:function(e,n,t){},26:function(e,n,t){"use strict";t.r(n);var i,a=t(1),s=t.n(a),o=t(8),c=t.n(o),r=(t(21),t(5)),l=t(7),d=t.n(l),u=t(11),h=t(14),g=t(4),m=t(27),p=t(12),f=t(13),j=t(2),x=1200;!function(e){e.INITIAL="initial",e.IMAGE="image",e.LINE_EDITING="lineEditing"}(i||(i={}));var b=function(){function e(){var n=this;Object(p.a)(this,e),this.imageDimensions=void 0,this.mode=void 0,this.container=void 0,this.isDragging=void 0,this.startPanPoz=void 0,this.panPoz=void 0,this.draggedLine=void 0,this.scale=void 0,this.nameInInput=void 0,this.highlightedLineId=void 0,this.lines=void 0,this.currentLineIndex=void 0,this.imageLoaded=void 0,this.handleMouseEnter=function(){n.mode===i.IMAGE&&document.getElementsByTagName("body")[0].classList.add("stop-scrolling")},this.handleMouseLeave=function(){n.mode===i.IMAGE&&(document.getElementsByTagName("body")[0].classList.remove("stop-scrolling"),n.setIsDragging(!1))},this.setContainer=function(e){n.container=e},this.setStartPanPoz=function(e){n.startPanPoz=e},this.setPanPoz=function(e){n.panPoz=e},this.setScale=function(e){n.scale=e},this.handleMouseDown=function(e){e.preventDefault(),n.imageLoaded&&n.mode===i.IMAGE&&(n.setIsDragging(!0),n.setStartPanPoz({x:e.clientX-n.panPoz.x,y:e.clientY-n.panPoz.y}))},this.handleMouseUp=function(e){e.preventDefault(),n.imageLoaded&&n.mode===i.IMAGE&&n.setIsDragging(!1)},this.handleMouseMove=function(e){if(e.preventDefault(),n.imageLoaded)if(n.mode===i.IMAGE)n.isDragging&&n.setPanPoz({x:e.clientX-n.startPanPoz.x,y:e.clientY-n.startPanPoz.y});else if(n.mode===i.LINE_EDITING&&n.container){var t={x:e.clientX-n.container.offsetLeft+window.scrollX,y:e.clientY-n.container.offsetTop+window.scrollY};n.draggedLine=t}},this.handleWheel=function(e){if(n.imageLoaded&&n.mode===i.IMAGE){var t=Math.min(Math.max(.125,n.scale+-.002*e.deltaY),4);n.setScale(t)}},this.handleScroll=function(e){e.preventDefault()},this.loadLinesData=function(e){n.lines=e.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{points:e.points.map((function(e){return{x:e.x*n.imageDimensions.x,y:e.y*n.imageDimensions.y}}))})}))},this.createNewLine=function(){n.nameInInput?(n.lines.push({name:n.nameInInput,points:[],id:Object(m.a)()}),n.nameInInput="",n.currentLineIndex=n.lines.length-1):alert("Please enter a name for the line")},this.deleteLastPoint=function(){n.lines[n.currentLineIndex]&&n.lines[n.currentLineIndex].points.length>0&&n.lines[n.currentLineIndex].points.pop()},this.deleteLine=function(){n.lines[n.currentLineIndex]&&(n.lines.splice(n.currentLineIndex,1),n.currentLineIndex--)},this.updateSelectedLine=function(e){n.currentLineIndex=n.lines.findIndex((function(n){return n.name===e}))},this.updateLineNewName=function(e){n.nameInInput=e},this.editExistingLineName=function(e){n.lines[n.currentLineIndex].name=e},this.handleClick=function(e){if((n.mode===i.INITIAL||n.mode===i.LINE_EDITING)&&n.container){if(n.mode=i.LINE_EDITING,n.currentLineIndex<0)return void alert("first create a new line with a name");var t={x:e.clientX-n.container.offsetLeft+window.scrollX,y:e.clientY-n.container.offsetTop+window.scrollY};n.lines[n.currentLineIndex].points.push(t)}},this.onKeyDown=function(e){"Escape"===e.key&&n.mode===i.LINE_EDITING&&(n.mode=i.INITIAL,n.draggedLine=null)},Object(j.d)(this,{}),this.isDragging=!1,this.mode=i.INITIAL,this.imageDimensions={x:0,y:0},this.startPanPoz={x:0,y:0},this.panPoz={x:0,y:0},this.draggedLine=null,this.scale=1,this.lines=[],this.highlightedLineId="",this.nameInInput="",this.imageLoaded=!1,this.currentLineIndex=-1}return Object(f.a)(e,[{key:"setImageDimensions",value:function(e){this.imageDimensions=e,this.imageLoaded=!0}},{key:"setIsDragging",value:function(e){this.mode===i.IMAGE&&(this.isDragging=e)}}]),e}(),v=new b,I=Object(a.createContext)(v),L=I.Provider,O=function(){return Object(a.useContext)(I)},y=t(3),w=t.n(y),C=t(0),N=Object(g.a)((function(e){var n=e.image,t=e.imageStyle,i=O();return n?Object(C.jsx)("img",{className:w.a.cragImage,style:t,src:n,alt:"",onLoad:function(e){var n=e.target,t=0,a=0;n.height/n.width<.5?(a=x,t=n.height*(x/n.width)):(t=600,a=n.width*(600/n.height)),i.setImageDimensions({x:a,y:t})}}):null})),D=t(15),E=Object(g.a)((function(e){var n=e.points,t=e.selected,i=O().draggedLine,a=(t&&i?[].concat(Object(D.a)(n),[i]):n).reduce((function(e,n){return"".concat(e," ").concat(n.x,",").concat(n.y)}),""),s=t?"#1ad34b":"#6247cb";return Object(C.jsx)("polyline",{points:a,style:{stroke:s,fill:"none",strokeWidth:3}})})),_=Object(g.a)((function(e){var n,t=e.svgStyle,i=O(),a=null===(n=i.lines[i.currentLineIndex])||void 0===n?void 0:n.id;return Object(C.jsx)("svg",{className:w.a.svgContainer,style:t,children:i.lines.filter((function(e){return e.points.length})).map((function(e){var n=e.id,t=e.points;return Object(C.jsx)(E,{points:t,selected:a===n},n)}))})})),P=Object(g.a)((function(){var e=O(),n=e.lines[e.currentLineIndex];return n?Object(C.jsxs)("div",{className:w.a.lineEditor,children:["Line Editor",Object(C.jsx)("div",{className:w.a.btn,onClick:function(){e.deleteLastPoint()},children:"Delete last point"}),Object(C.jsx)("div",{className:w.a.btn,onClick:function(){e.deleteLine()},children:"Delete Line"}),Object(C.jsxs)("div",{style:{display:"inline-block"},children:[Object(C.jsx)("span",{style:{paddingRight:"6px"},children:"Edit Line Name:"}),Object(C.jsx)("input",{type:"text",onChange:function(n){e.editExistingLineName(n.target.value)},value:n.name})]}),Object(C.jsx)("div",{style:{display:"inline-block",marginLeft:"6px"},children:e.lines.length>0&&Object(C.jsxs)(C.Fragment,{children:["Select Line:",Object(C.jsx)("select",{name:"linesSelector",onChange:function(n){e.updateSelectedLine(n.target.value)},value:n.name,children:e.lines.map((function(e){return Object(C.jsx)("option",{value:e.name,children:e.name},e.id)}))})]})})]}):null})),M=function(e){var n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,void 0,2)),t=document.createElement("a");t.setAttribute("href",n),t.setAttribute("download",Object(m.a)()+".json"),document.body.appendChild(t),t.click(),t.remove()},k=Object(g.a)((function(){var e=O(),n=s.a.useRef(null),t=e.imageDimensions,i=e.panPoz,o=e.scale,c=Object(a.useState)(),l=Object(h.a)(c,2),g=l[0],m=l[1],p=function(){var n=Object(u.a)(d.a.mark((function n(t){var i;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.target.files&&t.target.files[0]&&((i=new FileReader).readAsText(t.target.files[0],"UTF-8"),i.onload=function(n){var t;(null===(t=n.target)||void 0===t?void 0:t.result)&&e.loadLinesData(JSON.parse(n.target.result))});case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),f=function(){var n=Object(u.a)(d.a.mark((function n(){return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.lines.forEach((function(e){e.points[0].y<e.points[e.points.length-1].y&&(e.points=e.points.reverse())})),M(e.lines.sort((function(e,n){return e.points[0].x-n.points[0].x})).map((function(e){return Object(r.a)(Object(r.a)({},e),{},{points:e.points.map((function(e){return{x:e.x/t.x,y:e.y/t.y}}))})})));case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),j={},x={};Object(a.useEffect)((function(){n.current&&e.setContainer(n.current)}),[n]),t.x&&(j.width="".concat(t.x*o,"px"),j.height="".concat(t.y*o,"px"),x.transform="scale(".concat(o,")"),x.width="".concat(t.x*o,"px"),x.height="".concat(t.y*o,"px")),i.x&&(j.left="".concat(i.x,"px"),x.left="".concat(i.x,"px")),i.y&&(j.top="".concat(i.y,"px"),x.top="".concat(i.y,"px"));return Object(a.useEffect)((function(){return document.addEventListener("keydown",e.onKeyDown),function(){document.removeEventListener("keydown",e.onKeyDown)}}),[]),Object(C.jsxs)("div",{className:w.a.drawingCrags,children:[Object(C.jsx)("h2",{children:"Drawing Crags"}),Object(C.jsxs)("div",{children:[Object(C.jsx)("div",{children:"Welcome to the drawing crags app!"}),Object(C.jsxs)("div",{children:["To use the app:",Object(C.jsxs)("ul",{children:[Object(C.jsx)("li",{children:"Upload click on the upload crag image button to upload an image"}),Object(C.jsx)("li",{children:"Give a name to a line and create a new line"}),Object(C.jsx)("li",{children:"Start clicking on the image to draw the line points"}),Object(C.jsx)("li",{children:"Export the result file using the Export Lines Data button"})]})]}),Object(C.jsxs)("div",{style:{fontSize:"90%",color:"#727272"},children:["* You can also upload a previously generated file using the Import Lines Data button and edit Lines",Object(C.jsx)("br",{}),"Play around with the system a bit, we're sure you'll figure things out :)"]}),Object(C.jsx)("br",{})]}),Object(C.jsxs)("div",{children:[Object(C.jsxs)("div",{className:w.a.btnContainer,children:[Object(C.jsx)("div",{children:e.imageLoaded&&Object(C.jsxs)(C.Fragment,{children:[Object(C.jsx)("div",{className:w.a.btn,onClick:function(){e.createNewLine()},children:"+ New Line"}),Object(C.jsx)("div",{className:w.a.lineName,children:Object(C.jsx)("input",{type:"text",onChange:function(n){e.updateLineNewName(n.target.value)},value:e.nameInInput})})]})}),Object(C.jsxs)("div",{children:[Object(C.jsxs)("label",{className:w.a.fileUpload,children:[Object(C.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:function(n){if(n.target.files&&n.target.files[0]){var t=URL.createObjectURL(n.target.files[0]);e.setImageDimensions({x:0,y:0}),e.setScale(1),m(t)}}}),"Upload Crag Image"]}),Object(C.jsxs)("label",{className:w.a.fileUpload,children:[Object(C.jsx)("input",{type:"file",onChange:p}),"Import Lines Data"]}),Object(C.jsx)("div",{className:w.a.btn+" "+w.a.last,onClick:f,children:"Export Lines Data"})]})]}),Object(C.jsx)(P,{})]}),Object(C.jsxs)("div",{ref:n,className:w.a.imageContainer,onMouseEnter:e.handleMouseEnter,onMouseLeave:e.handleMouseLeave,onMouseDown:e.handleMouseDown,onMouseUp:e.handleMouseUp,onClick:e.handleClick,onMouseMove:e.handleMouseMove,onWheel:e.handleWheel,onScroll:e.handleScroll,style:x,children:[Object(C.jsx)(N,{image:g,imageStyle:j}),Object(C.jsx)(_,{svgStyle:x})]})]})})),S=new b,T=function(){return Object(C.jsx)(L,{value:S,children:Object(C.jsx)(k,{})})},z=(t(25),function(){return Object(C.jsx)(T,{})}),A=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,28)).then((function(n){var t=n.getCLS,i=n.getFID,a=n.getFCP,s=n.getLCP,o=n.getTTFB;t(e),i(e),a(e),s(e),o(e)}))};c.a.render(Object(C.jsx)(s.a.StrictMode,{children:Object(C.jsx)(z,{})}),document.getElementById("root")),A()},3:function(e,n,t){e.exports={drawingCrags:"drawingCrags_drawingCrags__3pW90",imageContainer:"drawingCrags_imageContainer__36Bch",cragImage:"drawingCrags_cragImage__vtfuJ",svgContainer:"drawingCrags_svgContainer__3H_v0",btn:"drawingCrags_btn__J0OEV",last:"drawingCrags_last__1BVBA",fileUpload:"drawingCrags_fileUpload__1zDh6",btnContainer:"drawingCrags_btnContainer__3jUL_",lineName:"drawingCrags_lineName__AiLPr",lineEditor:"drawingCrags_lineEditor__BTi0e"}}},[[26,1,2]]]);
//# sourceMappingURL=main.fec2c0cb.chunk.js.map