(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{2:function(e,n,t){e.exports={drawingCrags:"drawingCrags_drawingCrags__3pW90",imageContainer:"drawingCrags_imageContainer__36Bch",cragImage:"drawingCrags_cragImage__vtfuJ",svgContainer:"drawingCrags_svgContainer__3H_v0",btn:"drawingCrags_btn__J0OEV",last:"drawingCrags_last__1BVBA",fileUpload:"drawingCrags_fileUpload__1zDh6",btnContainer:"drawingCrags_btnContainer__3jUL_",lineName:"drawingCrags_lineName__AiLPr",lineEditor:"drawingCrags_lineEditor__BTi0e"}},21:function(e,n,t){},25:function(e,n,t){},26:function(e,n,t){"use strict";t.r(n);var i,a=t(1),o=t.n(a),s=t(8),r=t.n(s),c=(t(21),t(14)),l=t(4),d=t(5),u=t(12),h=t(13),g=t(3),p=t(27),f=1200;!function(e){e.INITIAL="initial",e.IMAGE="image",e.LINE_EDITING="lineEditing"}(i||(i={}));var j=function(){function e(){var n=this;Object(u.a)(this,e),this.imageDimensions=void 0,this.mode=void 0,this.container=void 0,this.isDragging=void 0,this.startPanPoz=void 0,this.panPoz=void 0,this.draggedLine=void 0,this.scale=void 0,this.nameInInput=void 0,this.highlightedLineId=void 0,this.lines=void 0,this.currentLineIndex=void 0,this.imageLoaded=void 0,this.isEditingLine=void 0,this.currentEditedPoint=void 0,this.handleMouseEnter=function(){n.mode===i.IMAGE&&document.getElementsByTagName("body")[0].classList.add("stop-scrolling")},this.handleMouseLeave=function(){n.mode===i.IMAGE&&(document.getElementsByTagName("body")[0].classList.remove("stop-scrolling"),n.setIsDragging(!1))},this.setContainer=function(e){n.container=e},this.setStartPanPoz=function(e){n.startPanPoz=e},this.setPanPoz=function(e){n.panPoz=e},this.setScale=function(e){n.scale=e},this.handleMouseDown=function(e){e.preventDefault(),n.imageLoaded&&n.mode===i.IMAGE&&(n.setIsDragging(!0),n.setStartPanPoz({x:e.clientX-n.panPoz.x,y:e.clientY-n.panPoz.y}))},this.handleMouseUp=function(e){e.preventDefault(),n.imageLoaded&&n.mode===i.IMAGE&&n.setIsDragging(!1)},this.handleMouseMove=function(e){if(e.preventDefault(),n.imageLoaded)if(n.mode===i.IMAGE)n.isDragging&&n.setPanPoz({x:e.clientX-n.startPanPoz.x,y:e.clientY-n.startPanPoz.y});else if(n.mode===i.LINE_EDITING&&n.container){var t={x:e.clientX-n.container.offsetLeft+window.scrollX,y:e.clientY-n.container.offsetTop+window.scrollY};n.draggedLine=t}},this.handleWheel=function(e){if(n.imageLoaded&&n.mode===i.IMAGE){var t=Math.min(Math.max(.125,n.scale+-.002*e.deltaY),4);n.setScale(t)}},this.handleScroll=function(e){e.preventDefault()},this.loadLinesData=function(e){n.lines=e.map((function(e){return Object(d.a)(Object(d.a)({},e),{},{points:e.points.map((function(e){return{x:e.x*n.imageDimensions.x,y:e.y*n.imageDimensions.y}}))})}))},this.createNewLine=function(){n.nameInInput?(n.lines.push({name:n.nameInInput,points:[],id:Object(p.a)()}),n.nameInInput="",n.currentLineIndex=n.lines.length-1):alert("Please enter a name for the line")},this.deleteLastPoint=function(){n.lines[n.currentLineIndex]&&n.lines[n.currentLineIndex].points.length>0&&n.lines[n.currentLineIndex].points.pop()},this.deleteLine=function(){n.lines[n.currentLineIndex]&&(n.lines.splice(n.currentLineIndex,1),n.currentLineIndex--)},this.updateSelectedLine=function(e){n.currentLineIndex=n.lines.findIndex((function(n){return n.name===e}))},this.updateLineNewName=function(e){n.nameInInput=e},this.editExistingLineName=function(e){n.lines[n.currentLineIndex].name=e},this.handleClick=function(e){if((n.mode===i.INITIAL||n.mode===i.LINE_EDITING)&&n.container){if(n.mode=i.LINE_EDITING,n.currentLineIndex<0)return void alert("first create a new line with a name");var t={x:e.clientX-n.container.offsetLeft+window.scrollX,y:e.clientY-n.container.offsetTop+window.scrollY};n.lines[n.currentLineIndex].points.push(t)}},this.setLinePoint=function(e,t,i){var a=n.lines.findIndex((function(n){return n.id===e}));-1!==a&&(n.lines[a].points[t]=i)},this.onKeyDown=function(e){"Escape"===e.key&&n.mode===i.LINE_EDITING&&(n.mode=i.INITIAL,n.draggedLine=null)},this.handlePointPointerDown=function(e,t,i){e.currentTarget.setPointerCapture(e.pointerId),n.currentEditedPoint={active:!0,lineId:t,pointIndex:i}},this.handleSvgPointerMove=function(e){var t=n.currentEditedPoint,i=t.active,a=t.lineId,o=t.pointIndex;if(i){var s=e.currentTarget.getBoundingClientRect(),r=e.clientX-s.left,c=e.clientY-s.top;n.setLinePoint(a,o,{x:r,y:c})}},this.handleSvgPointerUp=function(e){n.currentEditedPoint.active&&(n.currentEditedPoint={active:!1,lineId:"",pointIndex:0})},Object(g.d)(this,{}),this.isDragging=!1,this.mode=i.INITIAL,this.imageDimensions={x:0,y:0},this.startPanPoz={x:0,y:0},this.panPoz={x:0,y:0},this.draggedLine=null,this.scale=1,this.lines=[],this.highlightedLineId="",this.nameInInput="",this.imageLoaded=!1,this.isEditingLine=!1,this.currentLineIndex=-1,this.currentEditedPoint={active:!1,lineId:"",pointIndex:0}}return Object(h.a)(e,[{key:"setImageDimensions",value:function(e){this.imageDimensions=e,this.imageLoaded=!0}},{key:"setIsDragging",value:function(e){this.mode===i.IMAGE&&(this.isDragging=e)}}]),e}(),m=new j,x=Object(a.createContext)(m),v=x.Provider,b=function(){return Object(a.useContext)(x)},I=t(2),O=t.n(I),L=t(0),y=Object(l.a)((function(e){var n=e.image,t=e.imageStyle,i=b();return n?Object(L.jsx)("img",{className:O.a.cragImage,style:t,src:n,alt:"",onLoad:function(e){var n=e.target,t=0,a=0;n.height/n.width<.5?(a=f,t=n.height*(f/n.width)):(t=600,a=n.width*(600/n.height)),i.setImageDimensions({x:a,y:t})}}):null})),w=t(15),P=Object(l.a)((function(e){var n=e.positionX,t=e.positionY,i=e.fill,a=e.lineId,o=e.pointIndex,s=b(),r=s.handlePointPointerDown,c=s.currentEditedPoint,l=c.lineId===a&&c.pointIndex===o;return Object(L.jsx)("circle",{cx:n,cy:t,r:4,onPointerDown:function(e){return r(e,a,o)},fill:l?"blue":i,onClick:function(e){return e.stopPropagation()}})})),E=Object(l.a)((function(e){var n=e.points,t=e.isSelected,i=e.lineId,a=b().draggedLine,o=(t&&a?[].concat(Object(w.a)(n),[a]):n).reduce((function(e,n){return"".concat(e," ").concat(n.x,",").concat(n.y)}),""),s=t?"#1ad34b":"#6247cb",r=n.map((function(e,n){return Object(L.jsx)(P,{positionY:e.y,positionX:e.x,fill:s,pointIndex:n,lineId:i},"".concat(e.y,"-").concat(e.y,"-circle"))}));return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("polyline",{points:o,style:{stroke:s,fill:"none",strokeWidth:3}}),r]})})),C=Object(l.a)((function(e){var n,t=e.svgStyle,i=b(),a=i.lines,o=i.currentLineIndex,s=i.handleSvgPointerMove,r=i.handleSvgPointerUp,c=null===(n=a[o])||void 0===n?void 0:n.id;return Object(L.jsx)("svg",{className:O.a.svgContainer,style:t,onPointerUp:r,onPointerMove:s,children:a.filter((function(e){return e.points.length})).map((function(e){var n=e.id,t=e.points;return Object(L.jsx)(E,{points:t,isSelected:c===n,lineId:n},n)}))})})),D=function(){return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("h2",{children:"Drawing Crags"}),Object(L.jsxs)("div",{children:[Object(L.jsx)("div",{children:"Welcome to the drawing crags app!"}),Object(L.jsxs)("div",{children:["To use the app:",Object(L.jsxs)("ul",{children:[Object(L.jsx)("li",{children:"Upload click on the upload crag image button to upload an image"}),Object(L.jsx)("li",{children:"Give a name to a line and create a new line"}),Object(L.jsx)("li",{children:"Start clicking on the image to draw the line points"}),Object(L.jsx)("li",{children:'When done drawing a line, press "Escape" on keyboard to dismiss next point'}),Object(L.jsx)("li",{children:"Export the result file using the Export Lines Data button"})]})]}),Object(L.jsxs)("div",{style:{fontSize:"90%",color:"#727272"},children:["* You can also upload a previously generated file using the Import Lines Data button and edit Lines",Object(L.jsx)("br",{}),"Play around with the system a bit, we're sure you'll figure things out :)"]}),Object(L.jsx)("br",{})]})]})},N=t(7),_=t.n(N),M=t(11),S=Object(l.a)((function(){var e=b();if(!e.lines.length)return null;var n=e.lines[e.currentLineIndex];return Object(L.jsxs)("div",{className:O.a.lineEditor,children:[n&&Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("div",{className:O.a.btn,onClick:function(){e.deleteLastPoint()},children:"Delete last point"}),Object(L.jsx)("div",{className:O.a.btn,onClick:function(){e.deleteLine()},children:"Delete Line"}),Object(L.jsxs)("div",{style:{display:"inline-block"},children:[Object(L.jsx)("span",{style:{paddingRight:"6px"},children:"Edit Line Name:"}),Object(L.jsx)("input",{type:"text",onChange:function(n){e.editExistingLineName(n.target.value)},value:null===n||void 0===n?void 0:n.name})]})]}),Object(L.jsx)("div",{style:{display:"inline-block",marginLeft:"6px"},children:e.lines.length>0&&Object(L.jsxs)(L.Fragment,{children:["Select line to edit:",Object(L.jsxs)("select",{name:"linesSelector",onChange:function(n){e.updateSelectedLine(n.target.value)},value:null===n||void 0===n?void 0:n.name,children:[Object(L.jsx)("option",{value:"",children:"---------"},"select-line"),e.lines.map((function(e){return Object(L.jsx)("option",{value:e.name,children:e.name},e.id)}))]})]})})]})})),k=function(e){var n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,void 0,2)),t=document.createElement("a");t.setAttribute("href",n),t.setAttribute("download",Object(p.a)()+".json"),document.body.appendChild(t),t.click(),t.remove()},T=Object(l.a)((function(e){var n=e.onImageChange,t=b(),i=t.imageDimensions,a=function(){var e=Object(M.a)(_.a.mark((function e(n){var i;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.target.files&&n.target.files[0]&&((i=new FileReader).readAsText(n.target.files[0],"UTF-8"),i.onload=function(e){var n;(null===(n=e.target)||void 0===n?void 0:n.result)&&t.loadLinesData(JSON.parse(e.target.result))});case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),o=function(){var e=Object(M.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.lines.forEach((function(e){e.points[0].y<e.points[e.points.length-1].y&&(e.points=e.points.reverse())})),k(t.lines.sort((function(e,n){return e.points[0].x-n.points[0].x})).map((function(e){return Object(d.a)(Object(d.a)({},e),{},{points:e.points.map((function(e){return{x:e.x/i.x,y:e.y/i.y}}))})})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(L.jsxs)("div",{children:[Object(L.jsxs)("div",{className:O.a.btnContainer,children:[Object(L.jsx)("div",{children:t.imageLoaded&&Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("div",{className:O.a.btn,onClick:t.createNewLine,children:"+ New Line"}),Object(L.jsx)("div",{className:O.a.lineName,children:Object(L.jsx)("input",{type:"text",onChange:function(e){return t.updateLineNewName(e.target.value)},value:t.nameInInput})})]})}),Object(L.jsxs)("div",{children:[Object(L.jsxs)("label",{className:O.a.fileUpload,children:[Object(L.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:function(e){if(e.target.files&&e.target.files[0]){var i=URL.createObjectURL(e.target.files[0]);t.setImageDimensions({x:0,y:0}),t.setScale(1),n(i)}}}),"Upload Crag Image"]}),Object(L.jsxs)("label",{className:O.a.fileUpload,children:[Object(L.jsx)("input",{type:"file",onChange:a}),"Import Lines Data"]}),Object(L.jsx)("div",{className:O.a.btn+" "+O.a.last,onClick:o,children:"Export Lines Data"})]})]}),Object(L.jsx)(S,{})]})})),z=Object(l.a)((function(){var e=b(),n=o.a.useRef(null),t=e.imageDimensions,i=e.panPoz,s=e.scale,r=Object(a.useState)(),l=Object(c.a)(r,2),d=l[0],u=l[1],h={},g={};return Object(a.useEffect)((function(){n.current&&e.setContainer(n.current)}),[n]),t.x&&(h.width="".concat(t.x*s,"px"),h.height="".concat(t.y*s,"px"),g.transform="scale(".concat(s,")"),g.width="".concat(t.x*s,"px"),g.height="".concat(t.y*s,"px")),i.x&&(h.left="".concat(i.x,"px"),g.left="".concat(i.x,"px")),i.y&&(h.top="".concat(i.y,"px"),g.top="".concat(i.y,"px")),Object(a.useEffect)((function(){return document.addEventListener("keydown",e.onKeyDown),function(){document.removeEventListener("keydown",e.onKeyDown)}}),[]),Object(L.jsxs)("div",{className:O.a.drawingCrags,children:[Object(L.jsx)(D,{}),Object(L.jsx)(T,{onImageChange:u}),Object(L.jsxs)("div",{ref:n,className:O.a.imageContainer,onMouseEnter:e.handleMouseEnter,onMouseLeave:e.handleMouseLeave,onMouseDown:e.handleMouseDown,onMouseUp:e.handleMouseUp,onClick:e.handleClick,onMouseMove:e.handleMouseMove,onWheel:e.handleWheel,onScroll:e.handleScroll,style:g,children:[Object(L.jsx)(y,{image:d,imageStyle:h}),Object(L.jsx)(C,{svgStyle:g})]})]})})),A=new j,U=function(){return Object(L.jsx)(v,{value:A,children:Object(L.jsx)(z,{})})},G=(t(25),function(){return Object(L.jsx)(U,{})}),F=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,28)).then((function(n){var t=n.getCLS,i=n.getFID,a=n.getFCP,o=n.getLCP,s=n.getTTFB;t(e),i(e),a(e),o(e),s(e)}))};r.a.render(Object(L.jsx)(o.a.StrictMode,{children:Object(L.jsx)(G,{})}),document.getElementById("root")),F()}},[[26,1,2]]]);
//# sourceMappingURL=main.e041d572.chunk.js.map